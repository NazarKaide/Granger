<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ö–∞–∑–∫–æ–≤–∞ –∫–Ω–∏–≥–∞ ‚Äî –∫–∞—Ä–∫–∞—Å</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#081826;
    --paper:#fff7f1;
    --ink:#2b2b2b;
    --accent:#ff6fa3;
    --muted:#7a6b68;
    --gold:#ffd58a;
  }

  /* –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ü–µ–Ω–∞ */
  html,body{height:100%;margin:0;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto;background:linear-gradient(180deg,#04101a 0%,#0b2a3a 60%);color:var(--ink)}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box}

  /* –ö–Ω–∏–∂–∫–æ–≤–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —Ä–æ–±–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —Ä–æ–∑–≤–æ—Ä–æ—Ç */
  .book {
    width: 100%;
    max-width: 1100px;
    height: 72vh;
    max-height: 760px;
    perspective: 2200px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* –ü–∞–Ω–µ–ª—å, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ª—ñ–≤—É —ñ –ø—Ä–∞–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É */
  .spread {
    width: 92%;
    height: 100%;
    position: relative;
    display: flex;
    align-items: stretch;
    justify-content: center;
  }

  /* –õ—ñ–≤–∞ / –ü—Ä–∞–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (—Å—Ç–≤–æ—Ä—é—î–º–æ –≤–∏–≥–ª—è–¥ —Ä–æ–∑–≤–æ—Ä–æ—Ç—É) */
  .pane {
    width: calc(50% - 28px); /* —Ç—Ä–æ—Ö–∏ –≤—ñ–¥—Å—Ç—É–ø—É –¥–ª—è —à–≤–∞ */
    height: 100%;
    background: linear-gradient(180deg, #fffaf6, #fff6f1);
    border-radius: 10px;
    box-shadow: 0 30px 80px rgba(2,6,12,0.45);
    overflow: auto;
    padding: 36px;
    box-sizing: border-box;
    transform-style: preserve-3d;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    position: relative;
  }
  .pane.left { margin-right: 20px; transform-origin: right center; }
  .pane.right { margin-left: 20px; transform-origin: left center; }

  /* –†–µ–∂–∏–º –º–æ–±—ñ–ª—å–Ω–∏–π ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (–∫–æ–º–ø–∞–∫—Ç–Ω—ñ—à–µ) */
  @media (max-width: 820px) {
    .spread { flex-direction: column; gap: 18px; align-items: center; }
    .pane { width: 92%; height: 46%; margin: 0; border-radius: 12px; }
  }

  /* –¢—ñ–Ω—å / —à–æ–≤ –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏ (—Å–ø–∏–Ω–∞ –∫–Ω–∏–≥–∏) */
  .gutter {
    position: absolute;
    width: 44px;
    height: 82%;
    left: 50%;
    top: 9%;
    transform: translateX(-50%);
    border-radius: 8px;
    pointer-events: none;
    box-shadow: inset 0 12px 30px rgba(0,0,0,0.65);
    background: linear-gradient(90deg, rgba(0,0,0,0.25), rgba(255,255,255,0.03), rgba(0,0,0,0.15));
    z-index: 20;
  }

  /* Flipper - –Ω–∞–∫–ª–∞–¥–Ω–∞ "–ª–∏—Å—Ç–æ–∫" —è–∫–∏–π –∞–Ω—ñ–º—É—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—É–≤–∞–Ω–Ω—ñ */
  .flipper {
    position: absolute;
    top: 0;
    height: 100%;
    width: calc(50% - 28px);
    background: linear-gradient(180deg,#fffaf6,#fff6f1);
    border-radius: 10px;
    box-shadow: 0 30px 80px rgba(2,6,12,0.45);
    transform-style: preserve-3d;
    backface-visibility: hidden;
    transition: transform .72s cubic-bezier(.2,.9,.25,1), left .2s;
    z-index: 1000;
    overflow: hidden;
    padding: 36px;
    box-sizing: border-box;
  }
  .flipper .content { height:100%; overflow:auto; }

  /* Controls */
  .controls {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    z-index:1200;
  }
  .ctrl {
    width:44px;height:44px;border-radius:10px;border:none;background:rgba(255,255,255,0.95);display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 20px rgba(2,6,12,0.25)
  }
  .ctrl:active{transform:scale(.98)}
  .toggle-sound.active{background:linear-gradient(135deg,var(--accent),var(--gold));color:#fff}

  /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä */
  .indicator {
    position:absolute;bottom:12px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.95);padding:8px 12px;border-radius:20px;font-weight:600;color:var(--muted);z-index:1200;
  }

  /* –î—Ä—ñ–±–Ω—ñ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ñ –∫–ª–∞—Å–∏ */
  h2.title { font-family:'Playfair Display', serif; color:var(--accent); margin:0 0 6px; font-size:28px; text-align:center }
  p.lead { color:var(--muted); line-height:1.5; margin: 12px 0 0; text-align:center; max-width:520px; margin-left:auto;margin-right:auto }
  .photo { background:linear-gradient(135deg,#f4f4f4,#eaeaea); padding:14px; border-radius:8px; text-align:center; cursor:pointer; }
  .mini-grid{display:grid;grid-template-columns:1fr 1fr; gap:8px}

  /* canvas –±–ª–∏—Å–∫—ñ—Ç–æ–∫ */
  #sparkleCanvas { position:absolute; inset:0; pointer-events:none; z-index:110; }

  /* –õ–∞–π—Ç–±–æ–∫—Å */
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:2000;visibility:hidden;opacity:0;transition:opacity .2s}
  .lightbox.open{visibility:visible;opacity:1}
  .lightbox .card{background:#00000088;padding:20px;border-radius:10px;color:#fff;max-width:90%;max-height:90%;overflow:auto;text-align:center}

  /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É */
  @media (max-width: 820px) {
    .controls { left:50%; right:auto; top:auto; bottom:10px; transform:translateX(-50%); flex-direction:row; gap:8px; }
    .ctrl { width:38px;height:38px;border-radius:8px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="book" id="book">

    <!-- –†–æ–∑–≤–æ—Ä–æ—Ç: –¥–≤–∞ "pane" –∫—É–¥–∏ –º–∏ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="spread" id="spread">

      <div class="pane left" id="leftPane" aria-hidden="false"></div>
      <div class="pane right" id="rightPane" aria-hidden="false"></div>

      <!-- —à–æ–≤/—Å–ø–∏–Ω–∫–∞ -->
      <div class="gutter"></div>

      <!-- –Ω–∞–∫–ª–∞–¥–Ω–∏–π —Ñ–ª—ñ–ø–ø–µ—Ä (–¥–∏–Ω–∞–º—ñ—á–Ω–æ –¥–æ–¥–∞—î—Ç—å—Å—è/–∞–Ω—ñ–º—É—î—Ç—å—Å—è) -->
      <!-- –µ–ª–µ–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º –ø—Ä–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—É–≤–∞–Ω–Ω—ñ -->

      <!-- canvas –¥–ª—è –±–ª–∏—Å–∫—ñ—Ç–æ–∫ -->
      <canvas id="sparkleCanvas"></canvas>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
    <div class="controls" role="toolbar" aria-label="–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–Ω–∏–≥–æ—é">
      <button class="ctrl" id="prevBtn" title="–ü–æ–ø–µ—Ä–µ–¥–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞">‚Äπ</button>
      <button class="ctrl" id="nextBtn" title="–ù–∞—Å—Ç—É–ø–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞">‚Ä∫</button>
      <button class="ctrl toggle-sound" id="soundToggle" title="–£–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫">üîä</button>
    </div>

    <div class="indicator" id="indicator">–†–æ–∑–≤–æ—Ä–æ—Ç 1 / 4</div>

    <!-- –õ–∞–π—Ç–±–æ–∫—Å -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
      <div class="card" id="lightboxContent">–¢—É—Ç –±—É–¥–µ —Ñ–æ—Ç–æ</div>
    </div>

    <!-- ============================
         –®–ê–ë–õ–û–ù–ò –°–¢–û–†–Ü–ù–û–ö (–ª–µ–≥–∫–æ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏)
         - –ó–∞–º—ñ–Ω–∏ –≤–º—ñ—Å—Ç —Ç—É—Ç –Ω–∞ —Å–≤–æ—ó —Ñ–æ—Ç–æ/—Ç–µ–∫—Å—Ç–∏
         - JS –∑—á–∏—Ç—É—î —ó—Ö —ñ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —É –ø–∞–Ω–µ–ª—ñ
         ============================ -->
    <div id="templates" style="display:none">
      <div class="page-template" data-index="0">
        <div style="text-align:center">
          <div style="font-size:48px; color:var(--accent)">‚ú®</div>
          <h2 class="title">–ö–∞–∑–∫–æ–≤–∞ –∫–Ω–∏–≥–∞</h2>
          <div class="subtitle" style="color:var(--muted);text-align:center">–î–ª—è –º–æ—î—ó –Ω–∞–π—Ä—ñ–¥–Ω—ñ—â–æ—ó</div>
          <div style="height:12px"></div>
          <p class="lead">–í—ñ–¥–∫—Ä–∏–π —Ü—é –∫–Ω–∏–≥—É ‚Äî —ñ –º–∏ –ø–æ–º–∞–Ω–¥—Ä—É—î–º–æ –∑–Ω–æ–≤—É —á–µ—Ä–µ–∑ –Ω–∞—à—ñ –º–æ–º–µ–Ω—Ç–∏, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó, –ø—ñ—Å–Ω—ñ —ñ —Å–ø–æ–≥–∞–¥–∏.</p>
          <div style="position:absolute; left:36px; bottom:24px; color:var(--muted); font-size:13px">–ù–∞–ø–∏—Å–∞–Ω–æ –∑ –ª—é–±–æ–≤'—é ‚Äî –ù–∞–∑–∞—Ä</div>
        </div>
      </div>

      <div class="page-template" data-index="1">
        <div>
          <h2 style="margin-top:6px">–ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è</h2>
          <div style="height:8px"></div><div class="decor-line" style="height:4px;width:60px;background:linear-gradient(90deg,var(--accent),var(--gold));border-radius:3px"></div>
          <p style="font-family:'Playfair Display',serif;font-size:16px;color:var(--ink)">–ú–æ—è –¥–æ—Ä–æ–≥–∞, —Ü—è –∫–Ω–∏–≥–∞ ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∞–¥ —Å–ø–æ–≥–∞–¥—ñ–≤. –¢—É—Ç ‚Äî —Å–º—ñ—Ö, –º—É–∑–∏–∫–∞, –Ω–∞—à—ñ –ø–µ—Ä—à—ñ –¥–Ω—ñ –π —Ç–µ–ø–ª—ñ –≤–µ—á–æ—Ä–∏.</p>
          <div class="photo" style="margin-top:12px">üì∏ –ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –∑–±—ñ–ª—å—à–∏—Ç–∏ (—Ç—É—Ç –±—É–¥–µ —Ñ–æ—Ç–æ)<img src="index/2.jpg" width="350" height="400" text-align="center" alt="1"></div>
        
        </div>
      </div>

      <div class="page-template" data-index="2" data-illustration="petals">
        <div>
          <h2>–ú–æ–º–µ–Ω—Ç–∏</h2>
          <div style="height:8px"></div>
          <p>–ù–∞–π—è—Å–∫—Ä–∞–≤—ñ—à—ñ –º–∏—Ç—ñ, –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–ª—è –Ω–∞—Å:</p>
          <ul style="padding-left:18px;color:var(--muted)">
            <li>üå∏ –ü–µ—Ä—à–µ –ø–æ–±–∞—á–µ–Ω–Ω—è</li>
            <li>üåü –ü—Ä–æ–≥—É–ª—è–Ω–∫–∞ –ø—ñ–¥ –¥–æ—â–µ–º</li>
            <li>üí´ –ù–∞—à—ñ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∏ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ—é</li>
            <li>üéµ –£–ª—é–±–ª–µ–Ω–∞ –ø—ñ—Å–Ω—è —Ä–∞–∑–æ–º</li>
          </ul>
        </div>
      </div>

      <div class="page-template" data-index="3" data-illustration="clouds">
        <div>
          <h2>–ì–∞–ª–µ—Ä–µ—è</h2>
          <p>üì∏ –¢—É—Ç –±—É–¥—É—Ç—å –Ω–∞—à—ñ –Ω–∞–π–¥–æ—Ä–æ–∂—á—ñ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó</p>
          <div class="mini-grid" style="margin-top:12px">
            <div class="photo"><img src="index\2.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\3.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\4.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\5.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\6.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\7.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\8.jpg" width="150" height="150" alt="1"></div>
            <div class="photo"><img src="index\9.jpg" width="150" height="150" alt="1"></div>
          </div>
        </div>
      </div>

      <div class="page-template" data-index="4">
        <div>
          <h2>–ù–∞—à–∞ —Ö—Ä–æ–Ω—ñ–∫–∞</h2>
          <p>–ö–æ—Ä–æ—Ç–∫—ñ –∑—É–ø–∏–Ω–∫–∏ —É —á–∞—Å—ñ ‚Äî —Ç–µ, —â–æ –º–∏ –∑–≥–∞–¥—É—î–º–æ</p>
          <ul style="padding-left:0;list-style:none">
            <li style="background:rgba(0,0,0,0.04);padding:8px;border-radius:6px;margin-bottom:8px"><strong>05.07.2025</strong> ‚Äî –ü–æ—á–∞—Ç–æ–∫ –Ω–∞—à–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó</li>
            <li style="background:rgba(0,0,0,0.04);padding:8px;border-radius:6px;margin-bottom:8px"><strong>31.08.2025</strong> ‚Äî –ü–µ—Ä—à–∏–π –∫–æ–Ω—Ü–µ—Ä—Ç</li>
            <li style="background:rgba(0,0,0,0.04);padding:8px;border-radius:6px"><strong>–ö–æ–ª–∏—Å—å..</strong> ‚Äî –ù—ñ—á –ø—ñ–¥ –∑–æ—Ä—è–º–∏</li>
          </ul>
        </div>
      </div>

      <div class="page-template" data-index="5">
        <div>
          <h2>–ü–ª–µ–π–ª–∏—Å—Ç</h2>
          <p>–ú–µ–ª–æ–¥—ñ—ó, —è–∫—ñ –Ω–∞–≥–∞–¥—É—é—Ç—å –ø—Ä–æ –Ω–∞—Å</p>
          <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
            <iframe width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/soundcloud%253Atracks%253A2170106649&color=%23121110&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe><div style="font-size: 10px; color: #cccccc;line-break: anywhere;word-break: normal;overflow: hidden;white-space: nowrap;text-overflow: ellipsis; font-family: Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight: 100;"><a href="https://soundcloud.com/nazar-piasetskyi" title="Granger" target="_blank" style="color: #cccccc; text-decoration: none;">Granger</a> ¬∑ <a href="https://soundcloud.com/nazar-piasetskyi/love-you" title="Love you" target="_blank" style="color: #cccccc; text-decoration: none;">Love you</a></div>
          </div>
        </div>
      </div>

      <div class="page-template" data-index="6">
        <div>
          <h2>–ö—ñ–Ω–µ—Ü—å? –ù—ñ ‚Äî —Ç—ñ–ª—å–∫–∏ –ø–æ—á–∞—Ç–æ–∫</h2>
          <p style="font-family:'Playfair Display',serif">–©–µ –±–∞–≥–∞—Ç–æ —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –ø–æ–ø–µ—Ä–µ–¥—É. –î—è–∫—É—é, —â–æ —Ç–∏ —î –ø–æ—Ä—É—á.</p>
          <div style="margin-top:12px"><button id="loveBtnInline" style="padding:10px 16px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent),var(--gold));color:#fff;cursor:pointer">üíñ –õ—é–±–ª—é</button></div>
        </div>
      </div>

      <div class="page-template" data-index="7">
        <div>
          <h2>–°—é—Ä–ø—Ä–∏–∑</h2>
          <p>–¢–∏ –ø—Ä–æ–π—à–ª–∞ –∫–Ω–∏–≥—É ‚Äî –æ—Å—å –Ω–µ–≤–µ–ª–∏—á–∫–∏–π —Å—é—Ä–ø—Ä–∏–∑ –¥–ª—è –Ω–∞—Å</p>
          <div style="margin-top:12px;text-align:center;background:linear-gradient(135deg,#f0f0f0,#e0e0e0);padding:18px;border-radius:8px">üé¨ –í—ñ–¥–µ–æ —Å—é—Ä–ø—Ä–∏–∑ (—Ç—É—Ç –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –≤—ñ–¥–µ–æ)</div>
          <video controls width="100%" style="border-radius:12px;max-height:360px">
          <source src="index/video0.mp4" type="video/mp4">
        </div>
      </div>
    </div>
    <!-- /templates -->
  </div>
</div>

<!-- –ó–≤—É–∫ —Ñ–ª—ñ–ø—É (–¥–∞–Ω–∏–π URL ‚Äî –ø—Ä–∏–∫–ª–∞–¥, –º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Å–≤—ñ–π —Ñ–∞–π–ª) -->
<audio id="flipAudio" preload="auto" style="display:none">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_d9ce3b7f07.mp3?filename=page-flip-14612.mp3" type="audio/mpeg">
</audio>

<script>
/* ===========================
   JS: –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–Ω–∏–∂–∫–æ—é ‚Äî –∫–∞—Ä–∫–∞—Å
   - —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Ä–æ–∑–≤–æ—Ä–æ—Ç–∏ –∑ —à–∞–±–ª–æ–Ω—ñ–≤
   - —Ä–æ–±–∏—Ç—å —Ñ–ª—ñ–ø –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞–∫–ª–∞–¥–Ω–æ–≥–æ .flipper
   - –ø—ñ–¥—Ç—Ä–∏–º—É—î next/prev, –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É, —Å–≤–∞–π–ø
   - –ª–∞–π—Ç–±–æ–∫—Å, –±–ª–∏—Å–∫—ñ—Ç–∫–∏, –ø–µ–ª—é—Å—Ç–∫–∏
   - –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –æ–≥–æ–ª–æ—à–µ–Ω—ñ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
   =========================== */

(() => {
  // DOM –µ–ª–µ–º–µ–Ω—Ç–∏
  const templatesRoot = document.getElementById('templates');
  const templateNodes = Array.from(templatesRoot.querySelectorAll('.page-template'))
    .sort((a,b)=> (+a.dataset.index) - (+b.dataset.index));
  const pagesData = templateNodes.map(n => ({ html: n.innerHTML, illustration: n.dataset.illustration || '' }));
  const maxSpreads = Math.ceil(pagesData.length / 2);

  const leftPane = document.getElementById('leftPane');
  const rightPane = document.getElementById('rightPane');
  const spreadEl = document.getElementById('spread');
  const indicator = document.getElementById('indicator');
  const flipAudio = document.getElementById('flipAudio');

  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  const soundToggle = document.getElementById('soundToggle');

  // sparkles canvas
  const canvas = document.getElementById('sparkleCanvas');
  const ctx = canvas.getContext && canvas.getContext('2d');
  let particles = [];
  function resizeCanvas(){ if(!ctx) return; canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // state
  let currentSpread = 0; // 0 -> pages 0-1
  let isAnimating = false;
  let soundOn = true;

  function updateIndicator(){ indicator.textContent = `–†–æ–∑–≤–æ—Ä–æ—Ç ${currentSpread+1} / ${maxSpreads}`; }

  // render current spread into panes
  function renderSpread(){
    const leftIdx = currentSpread*2;
    const rightIdx = currentSpread*2 + 1;
    leftPane.innerHTML = pagesData[leftIdx] ? pagesData[leftIdx].html : '';
    rightPane.innerHTML = pagesData[rightIdx] ? pagesData[rightIdx].html : '';
    updateIndicator();
    attachPhotoHandlers(leftPane);
    attachPhotoHandlers(rightPane);
    attachInlineButtons(); // play/love –∫–Ω–æ–ø–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–Ω—Ç—É
    showIllustrationAnimations();
  }

  // play flip sound
  function playFlip(){
    if(!soundOn) return;
    try { flipAudio.currentTime = 0; flipAudio.play().catch(()=>{}); } catch(e){}
  }

  // spawn a simple sparkles burst at x,y (client coords)
  function createSparkle(x,y){
    if(!ctx) return;
    const rect = canvas.getBoundingClientRect();
    particles.push({
      x: x - rect.left,
      y: y - rect.top,
      vx: (Math.random()-0.5)*6,
      vy: -2 - Math.random()*2,
      life: 60,
      size: 2 + Math.random()*3,
      color: `hsl(${300 + Math.random()*60},80%,${60 + Math.random()*20}%)`
    });
  }
  function spawnSparkles(x,y){
    if(!ctx) return;
    for(let i=0;i<12;i++){
      setTimeout(()=> createSparkle(x + (Math.random()*30-15), y + (Math.random()*30-15)), i*8);
    }
  }
  function animateParticles(){
    if(!ctx) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.life--;
      ctx.globalAlpha = Math.max(0, p.life / 60);
      ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
      if(p.life<=0) particles.splice(i,1);
    }
    requestAnimationFrame(animateParticles);
  }
  animateParticles();

  // lightbox
  const lightbox = document.getElementById('lightbox');
  const lightboxContent = document.getElementById('lightboxContent');
  window.closeLightbox = function(){ lightbox.classList.remove('open'); };
  function openLightbox(html){
    lightboxContent.innerHTML = html;
    lightbox.classList.add('open');
    spawnSparkles(window.innerWidth/2, window.innerHeight/2);
  }

  // attach click handlers to .photo elements inside a pane
  function attachPhotoHandlers(root){
    root.querySelectorAll && root.querySelectorAll('.photo').forEach(el=>{
      el.style.cursor = 'pointer';
      el.addEventListener('click', (e)=>{
        e.stopPropagation();
        openLightbox(`<div style="font-size:40px; margin-bottom:10px">‚ú®</div><div style="font-size:18px">${el.innerHTML}</div>`);
      });
    });
  }

  // inline buttons (play/love) inside templates
  function attachInlineButtons(){
    const playInline = document.getElementById('playBtnInline');
    if(playInline){
      playInline.onclick = (e)=>{ e.stopPropagation(); // simple tone melody
        simpleMelody(); spawnSparkles(window.innerWidth/2, window.innerHeight/2);
      };
    }
    const loveInline = document.getElementById('loveBtnInline');
    if(loveInline){
      loveInline.onclick = (e)=>{ e.stopPropagation(); spawnHearts(); for(let i=0;i<8;i++) setTimeout(()=>spawnSparkles(window.innerWidth/2, window.innerHeight/2), i*60); };
    }
  }

  // spawn hearts
  function spawnHearts(){
    for(let i=0;i<10;i++){
      const heart = document.createElement('div');
      heart.textContent = '‚ù§Ô∏è';
      heart.style.position = 'fixed';
      heart.style.left = (30 + Math.random()*40) + '%';
      heart.style.bottom = '10%';
      heart.style.fontSize = (18 + Math.random()*20) + 'px';
      heart.style.zIndex = 2500;
      document.body.appendChild(heart);
      heart.animate([{ transform:'translateY(0) scale(1)', opacity:1 }, { transform:`translateY(-${80 + Math.random()*120}px) scale(.5)`, opacity:0 }], { duration:1300 + Math.random()*400, easing:'ease-out' });
      setTimeout(()=> heart.remove(), 1600);
    }
  }

  // simple tone melody (synth)
  let melodyTimer = null, melodyPlaying = false;
  function simpleMelody(){
    if(melodyPlaying){ melodyPlaying=false; if(melodyTimer) clearTimeout(melodyTimer); return; }
    melodyPlaying = true;
    const notes = [262,330,392,523];
    let i=0;
    const playNext = ()=>{
      if(!melodyPlaying) return;
      playTone(notes[i % notes.length], 0.25);
      i++;
      melodyTimer = setTimeout(playNext, 350);
    };
    playNext();
    setTimeout(()=> melodyPlaying=false, 8000);
  }
  function playTone(freq, duration){
    if(!soundOn) return;
    try{
      const ctxA = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctxA.createOscillator();
      const g = ctxA.createGain();
      o.connect(g); g.connect(ctxA.destination);
      o.frequency.value = freq; o.type = 'sine';
      g.gain.setValueAtTime(0.07, ctxA.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ctxA.currentTime + duration);
      o.start(); o.stop(ctxA.currentTime + duration);
    }catch(e){}
  }

  // show small page-specific animations: petals / clouds
  function showIllustrationAnimations(){
    // clear layers
    document.querySelectorAll('.floating-temp').forEach(n=>n.remove());
    const leftIdx = currentSpread*2;
    const leftData = pagesData[leftIdx];
    if(!leftData) return;
    const ill = leftData.illustration;
    const layer = document.createElement('div');
    layer.className = 'floating-temp';
    layer.style.position = 'absolute';
    layer.style.inset = '0';
    layer.style.pointerEvents = 'none';
    leftPane.appendChild(layer);
    if(ill === 'petals'){
      for(let i=0;i<8;i++){
        const p = document.createElement('div');
        p.className = 'petal';
        p.style.left = (Math.random()*100)+'%';
        p.style.top = '-10vh';
        p.style.animation = `petalFall ${4000 + Math.random()*3000}ms linear ${i*150}ms forwards`;
        layer.appendChild(p);
      }
    } else if(ill === 'clouds'){
      for(let i=0;i<3;i++){
        const c = document.createElement('div');
        c.className = 'cloud';
        c.style.left = (15 + i*25) + '%';
        c.style.top = (10 + Math.random()*15) + '%';
        c.style.animation = `cloudFloat ${4000 + i*1000}ms ease-in-out infinite alternate`;
        layer.appendChild(c);
      }
    }
  }

  // ----------------------
  // FLIP ANIMATION
  // - –¥–ª—è next: –Ω–∞–∫–ª–∞–¥–∞—î–º–æ flipper –Ω–∞–¥ –ø—Ä–∞–≤–æ—é –ø–∞–Ω–µ–ª–ª—é, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –ø—Ä–∞–≤–∏–π –≤–º—ñ—Å—Ç,
  //   –∞–Ω—ñ–º—É—î–º–æ –π–æ–≥–æ rotateY(0 -> -180deg) –∑ origin left (–ø–µ—Ä–µ–ª–∏—Å—Ç—É–≤–∞–Ω–Ω—è –≤–ø—Ä–∞–≤–æ->–≤–ª—ñ–≤–æ)
  // - –¥–ª—è prev: –Ω–∞–∫–ª–∞–¥–∞—î–º–æ flipper –Ω–∞–¥ –ª—ñ–≤–æ—é –ø–∞–Ω–µ–ª–ª—é, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –ª—ñ–≤–∏–π –≤–º—ñ—Å—Ç,
  //   –∞–Ω—ñ–º—É—î–º–æ rotateY(0 -> 180deg) –∑ origin right (–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞–∑–∞–¥)
  // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –æ–Ω–æ–≤–ª—é—î–º–æ currentSpread —ñ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ –Ω–æ–≤–∏–π —Ä–æ–∑–≤–æ—Ä–æ—Ç.
  // ----------------------

  function createFlipper(side /*'left'|'right'*/, contentHtml){
    const fl = document.createElement('div');
    fl.className = 'flipper';
    const inner = document.createElement('div');
    inner.className = 'content';
    inner.innerHTML = contentHtml;
    fl.appendChild(inner);
    // –ø–æ–∑–∏—Ü—ñ—é—î–º–æ –Ω–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—é –ø–∞–Ω–µ–ª–ª—é
    if(side === 'right'){
      fl.style.right = ( (window.innerWidth <= 820) ? '4%': 'calc(4% - 0px)' ); // small-screen adjust
      fl.style.left = 'auto';
      fl.style.transformOrigin = 'left center';
    } else {
      fl.style.left = ( (window.innerWidth <= 820) ? '4%' : 'calc(4% - 0px)' );
      fl.style.right = 'auto';
      fl.style.transformOrigin = 'right center';
    }
    // match size
    const paneWidth = document.querySelector('.pane.left').getBoundingClientRect().width;
    fl.style.width = paneWidth + 'px';
    fl.style.height = '100%';
    return fl;
  }

  function nextSpread(){
    if(isAnimating) return;
    if(currentSpread >= maxSpreads - 1){
      // –∫—ñ–Ω—Ü–µ–≤–∞ –¥—ñ—è: –ø–æ–∫–∞–∑–∞—Ç–∏ —Å—é—Ä–ø—Ä–∏–∑ –∞–±–æ –ø—Ä–æ—Å—Ç–æ –∑—É–ø–∏–Ω–∏—Ç–∏—Å—å
      openLightbox('<div style="font-size:26px;color:#fff">üéâ –¶–µ –∫—ñ–Ω–µ—Ü—å –∫–Ω–∏–≥–∏ ‚Äî —Å—é—Ä–ø—Ä–∏–∑ —Ç—É—Ç!</div>');
      return;
    }
    isAnimating = true;
    // content of current right page
    const rightIdx = currentSpread*2 + 1;
    const rightHtml = pagesData[rightIdx] ? pagesData[rightIdx].html : '';
    // create flipper over right side
    const fl = createFlipper('right', rightHtml);
    // place it exactly overlapping the right pane
    const rectRight = rightPane.getBoundingClientRect();
    const rectSpread = spreadEl.getBoundingClientRect();
    fl.style.top = (rectRight.top - rectSpread.top) + 'px';
    fl.style.left = (rectRight.left - rectSpread.left) + 'px';
    spreadEl.appendChild(fl);

    // ensure repaint
    requestAnimationFrame(()=>{
      playFlip();
      // animate to -180deg
      fl.style.transform = 'rotateY(-180deg)';
      const onEnd = (e)=>{
        if(e.propertyName !== 'transform') return;
        fl.removeEventListener('transitionend', onEnd);
        // –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—É–≤–∞–Ω–Ω—è ‚Äî –ø—ñ–¥–Ω—è—Ç–∏ spread
        currentSpread = Math.min(currentSpread + 1, maxSpreads - 1);
        renderSpread();
        spawnSparkles(window.innerWidth/2, window.innerHeight/2);
        fl.remove();
        isAnimating = false;
      };
      fl.addEventListener('transitionend', onEnd);
      // safety fallback
      setTimeout(()=>{ if(isAnimating){ isAnimating=false; currentSpread = Math.min(currentSpread + 1, maxSpreads -1); renderSpread(); fl.remove(); } }, 1000);
    });
  }

  function prevSpread(){
    if(isAnimating) return;
    if(currentSpread <= 0) return;
    isAnimating = true;
    // content of current left page
    const leftIdx = currentSpread*2;
    const leftHtml = pagesData[leftIdx] ? pagesData[leftIdx].html : '';
    const fl = createFlipper('left', leftHtml);
    // position over left pane
    const rectLeft = leftPane.getBoundingClientRect();
    const rectSpread = spreadEl.getBoundingClientRect();
    fl.style.top = (rectLeft.top - rectSpread.top) + 'px';
    fl.style.left = (rectLeft.left - rectSpread.left) + 'px';
    spreadEl.appendChild(fl);

    // animate flip to 180deg (flip right)
    requestAnimationFrame(()=>{
      playFlip();
      fl.style.transform = 'rotateY(180deg)';
      const onEnd = (e)=>{
        if(e.propertyName !== 'transform') return;
        fl.removeEventListener('transitionend', onEnd);
        currentSpread = Math.max(0, currentSpread - 1);
        renderSpread();
        spawnSparkles(window.innerWidth/2, window.innerHeight/2);
        fl.remove();
        isAnimating = false;
      };
      fl.addEventListener('transitionend', onEnd);
      setTimeout(()=>{ if(isAnimating){ isAnimating=false; currentSpread = Math.max(0, currentSpread -1); renderSpread(); fl.remove(); } }, 1000);
    });
  }

  // Keybinds & buttons
  nextBtn.addEventListener('click', nextSpread);
  prevBtn.addEventListener('click', prevSpread);
  document.addEventListener('keydown', (e)=>{ if(e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSpread(); } if(e.key === 'ArrowLeft') prevSpread(); });

  // touch gestures (simple)
  let touchStartX = 0; let lastTouch = 0;
  spreadEl.addEventListener('touchstart', (e)=>{ touchStartX = e.changedTouches[0].screenX; }, {passive:true});
  spreadEl.addEventListener('touchend', (e)=>{
    const now = Date.now(); if(now - lastTouch < 300) return; lastTouch = now;
    const diff = e.changedTouches[0].screenX - touchStartX;
    if(Math.abs(diff) > 50) diff < 0 ? nextSpread() : prevSpread();
  }, {passive:true});

  // toggling sound
  soundToggle.addEventListener('click', ()=>{
    soundOn = !soundOn;
    soundToggle.classList.toggle('active', soundOn);
  });

  // clicking on spread produces sparkles
  spreadEl.addEventListener('click', (e)=>{
    if(e.target.closest('.ctrl')) return;
    spawnSparkles(e.clientX, e.clientY);
  });

  // expose some functions for debugging (optional)
  window.kbook = { nextSpread, prevSpread, renderSpread };

  // initial render
  renderSpread();
  updateIndicator();

  // resize canvas after layout
  setTimeout(resizeCanvas, 200);
  window.addEventListener('load', ()=>{ setTimeout(()=> spawnSparkles(window.innerWidth/2, window.innerHeight/2), 500); });

})(); // IIFE
</script>
</body>
</html>
